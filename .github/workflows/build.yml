name: Build


on:
  push:
  workflow_call:
    inputs:
      commit:  # For release version bump commit
        required: false
        type: string
      environment:
        required: false
        type: string
      prettyfy:  # For HTML diff
        required: false
        type: boolean
      skip_lints_tests:
        required: false
        type: boolean
      sphinx_github_branch:  # For HTML diff and production (tag vs branch)
        required: false
        type: string


jobs:

  Build:
    runs-on: ubuntu-latest
    environment: "${{ inputs.environment }}"  # Note: can be empty
    steps:

      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          ref: "${{ inputs.commit }}"

      - name: Setup Dependencies
        uses: ./.github/actions/deps

      - name: Build
        run: npx next build && cp -v .gitignore out/

      - name: Upload Artifact
        uses: actions/upload-artifact@v3
        with:
          name: html
          path: out
          if-no-files-found: error

      - name: Upload package-lock.json
        uses: actions/upload-artifact@v3
        with:
          name: package_lock
          path: package-lock.json
          if-no-files-found: error
